此项目可能不再维护
# Auto Captcha Responder

自动识别群管/机器人发送的进群验证码，并在指定条件下代替用户发送验证码回复的 AstrBot 插件。

## 功能特性

- 支持常见中文验证码话术的自动识别（“请输入验证码 XXXX”“请回复 XXXX 验证身份”等）
- 支持数字验证码和数字 + 大小写字母混合验证码
- 可配置是否仅在“艾特机器人”时才触发验证逻辑
- 可配置发送前延迟，模拟真人思考 / 输入时间
- 支持在 WebUI 中添加自定义正则表达式，扩展更多验证码格式

> 当前设计：插件只发送提取到的验证码本体，不附加任何前缀文本。

## 安装方式

1. 将本插件目录放入 AstrBot 插件目录：

   ```text
   AstrBot/
     data/
       plugins/
         auto_captcha_responder/
           auto_captcha_responder/
             main.py
             __init__.py
             metadata.yaml
             _conf_schema.json
             readme.md
   ```

2. 启动 AstrBot（或在 WebUI 中重载插件）。
3. 在 AstrBot WebUI 的“插件管理”中找到“自动验证码回复”插件，启用并完成配置。

## 配置说明（WebUI）

在插件配置页中，可以看到以下选项（由 `_conf_schema.json` 提供）：

- `enabled`：是否启用自动验证码回复  
  - `true`：正常工作  
  - `false`：完全关闭，不匹配任何验证码

- `require_at_bot`：仅在消息艾特机器人时触发  
  - `true`（推荐）：只有消息中 @ 了机器人（`is_at_or_wake_command` 为真）时才会尝试识别并回复验证码  
  - `false`：只要群消息文本中出现验证码话术就会触发（风险更高，慎用）

- `quote_message`：发送验证码时是否引用原消息  
  - 当前实现为逻辑开关，默认开启。  
  - 插件最终只发送验证码内容本身，实际表现为普通文本消息。

- `delay_seconds`：发送验证码前延迟的秒数  
  - 类型：浮点数，支持 0 ~ 30 秒  
  - 例：设置为 `2` 时，机器人在识别验证码后会等待约 2 秒再发送验证码

- `custom_patterns`：自定义验证码匹配表达式列表  
  - 类型：字符串列表（每行一个正则）  
  - 要求：每条正则必须至少包含一个捕获组，插件会使用第一个捕获组作为验证码内容  
  - 示例：

    ```regex
    请在\d+分钟内输入验证码\s*([0-9A-Za-z]{4,10})
    回复\s*「?([0-9A-Za-z]{4,10})」?\s*完成验证
    ```

## 内置匹配规则

插件默认内置了一些常见中文话术的正则表达式，包括但不限于：

- `请回复 XXXX 验证身份`
- `输入「XXXX」加入群聊`
- `请输入验证码 XXXX`
- `回复 XXXX 通过验证`
- `验证码 XXXX`
- `请发送 XXXX 完成验证`

不同话术中的 `XXXX` 会被识别为验证码内容（数字或数字+字母），由第一个捕获组提取。

## 工作流程概述

1. 收到群消息事件（`EventMessageType.GROUP_MESSAGE`）。
2. 若开启 `require_at_bot`，且消息没有 @ 机器人，则直接忽略。
3. 从消息中提取纯文本内容 `message_str`。
4. 依次尝试内置正则和 `custom_patterns` 中的正则：
   - 若没有任何匹配，结束处理。
   - 若匹配成功，读取第一个捕获组作为验证码。
5. 若设置了 `delay_seconds`，则等待对应秒数。
6. 将验证码本体作为文本消息发送到当前会话。

## 使用建议

- 为了避免误触，强烈建议：
  - 开启 `require_at_bot`，只在消息 @ 机器人时自动回复验证码。
  - 将 `delay_seconds` 设置为 1~3 秒，模拟正常用户反应时间。
- 如验证码话术较多且不稳定，可以通过 `custom_patterns` 精细控制仅匹配特定格式的验证码。

## 许可证

本插件默认遵循与 AstrBot 插件生态相同的开源许可证；如需更改，请在 `metadata.yaml` 中补充完整的版权和仓库信息。***
